syntax = "proto3";

option go_package = "opsnlops.io/creatures/server";
option java_multiple_files = true;
option java_package = "io.opsnlops.creatures.server";
option java_outer_classname = "NetworkServerProto";

package server;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

// TODO: This might be helpful later!
// import "google/protobuf/wrappers.proto";

service CreatureServer {

  // Fetches one from the database
  rpc GetCreature (CreatureId) returns (Creature) {}

  // Get all of them
  rpc GetCreatures (google.protobuf.Empty) returns (stream Creature) {}

  // Create a new creature in the database
  rpc CreateCreature(Creature) returns (DatabaseInfo) {}

  // Update an existing creature in the database
  rpc UpdateCreature(Creature) returns (DatabaseInfo) {}

  // Stream log messages from the server
  rpc StreamLogs(LogFilter) returns (stream LogLine) {}

  // Search for a Creature by name
  rpc SearchCreatures (CreatureName) returns (Creature) {}

}

message DatabaseInfo {
  string message = 1;
  string help = 2;

}

message LogFilter {
  LogLevel level = 1;
}

message CreatureId {
  bytes _id = 1;
}

message CreatureName {
  string name = 1;
}

message Creature {
  bytes _id = 1;
  string name = 2;
  google.protobuf.Timestamp last_updated = 3;
  string sacn_ip = 4;
  uint32 universe = 5;
  uint32 dmx_base = 6;
  uint32 number_of_motors = 7;
  repeated Motor motors = 8;

  enum MotorType {
    servo = 0;
    stepper = 1;
  }

  message Motor {
    bytes _id = 1;
    MotorType type = 2;
    uint32 number = 3;
    uint32 max_value = 4;
    uint32 min_value = 5;
    double smoothing_value = 6;
  }
}


message LogLine {
    LogLevel level = 1;
    google.protobuf.Timestamp timestamp = 2;
    string message = 3;
}

enum LogLevel {
  trace = 0;
  debug = 1;
  info = 2;
  warn = 3;
  error = 4;
  critical = 5;
  fatal = 6;
}
